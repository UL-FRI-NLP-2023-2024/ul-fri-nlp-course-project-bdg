[
    {
        "role": "user",
        "message": "Pozdravljeni.  Že dalj časa se zafrkavam z nalogo za faks, pa mi nikakor ne uspe naredit..  Naloga se glasi:   shm1a  program shm1a ustvari še en skupen pomnilnik, ki bo sprejel niz dolg 20 znakov, nato v vrtavki \"počaka\", da mu proces shm1b sporoči, da je napolnil drugi skupni pomnilnik s \"pametnimi\" podatki, preden se zaključi, izpiše na zaslon podatke iz drugega skupnega pomnilnika.   shm1b  poveže se na nov skupni pomnilnik in ga napolni z razumljivimi podatki (niz naj bo dolg cca 20 znakov, kot je velik skupni pomnilnik), \"sporoči\" prejšnjemu procesu, da je končal z operacijo (ostane enako kot prejšnji teden).  Nato ponovno napišite dva programa (shm2a in shm2b), kjer popolnoma enak problem rešite s pomočjo semaforja. Namig: prvi (signalni) skupni pomnilnik in vrtavko nadomestite s semaforjem.   shm1a in shm1b imam narejena, problem se mi sedaj pojavlja pri shm2a (prejšnji teden je še delalo ok?) ko mi ne ustvarja semaforja/skupnega pomnilnika  evo še koda:    SHM2A    #include<stdio.h>\n#include<stdlib.h>\n#include<sys/shm.h>\n#include<sys/sem.h>\n\nint main() {\n\tint shmid, sem_id;\n\tchar* k;\n\tstruct sembuf sem;\n\n\tshmid=shmget(1004, sizeof(20), IPC_EXCL|IPC_CREAT|0600);\n\n\tif(shmid<0) {\n\t\tprintf(\"Napaka shmid!\\n\");\n\t}\n\telse {\n\t\tprintf(\"OK\\n\");\t\n\t}\n\n\tk=(char*)shmat(shmid,(void*)0,0);\n\tif(k==(char*)-1) {\n\t\tprintf(\"Napaka k!\\n\");\n\t}\n\telse {\n\t\tprintf(\"OK\\n\");\n\t}\n\n\tk=\"\";\n\tsem_id=semget(1005,1,IPC_CREAT|IPC_EXCL|0600);\n\n\tif(sem_id<0) {\n\t\tprintf(\"Napaka sem_id!\\n\");\n\t}\n\telse {\n\t\tprintf(\"OK\\n\");\n\t}\n\n\tsemctl(sem_id,0,SETVAL,1);\n\n\tsem.sem_flg=0;\n\tsem.sem_num=0;\n\tsem.sem_op=-1;\n\tsemop(sem_id,&sem,1);\n\tprintf(k);\n\tsem.sem_op=1;\n\tsemop(sem_id,&sem,1);\n\n\tsemctl(sem_id,0,IPC_RMID);\n\tshmctl(shmid,IPC_RMID,0);\n\n\tshmdt(k);\n\n\treturn 0;\t\n}\n    SHM2B      #include<stdio.h>\n#include<stdlib.h>\n#include<sys/shm.h>\n#include<sys/sem.h>\n\nint main() {\n\tint shmid, sem_id;\n\tchar* k;\n\tstruct sembuf sem;\n\n\tshmid=shmget(1004,0,0);\n\n\tif(shmid<0) {\n\t\tprintf(\"Napaka shmid!\\n\");\n\t}\n\telse {\n\t\tprintf(\"OK\\n\");\n\t}\n\n\tk=(char*)shmat(shmid,(void*)0,0);\n\n\tif(k==(char*)-1) {\n\t\tprintf(\"Napaka k!\\n\");\n\t}\n\telse {\n\t\tprintf(\"OK\\n\");\n\t}\n\n\tsem_id=semget(1005,0,0);\n\tif(sem_id<0) {\n\t\tprintf(\"Napaka sem_id\\n\");\n\t\treturn 1;\n\t}\n\telse {\n\t\tprintf(\"OK\\n\");\n\t}\n\n\tsemctl(sem_id,0,SETVAL,1);\n\n\tsem.sem_op=-1;\n\tsem.sem_flg=0;\n\tsem.sem_num=0;\n\tsemop(sem_id,&sem,1);\n\tk=\"Niz dolg 20 znakov..\";\n\tsem.sem_op=-1;\n\tsemop(sem_id,&sem,1);\n\n\tshmdt(k);\n\n\treturn 0;\n}\n   Če bi mi lahko kdo pomagal pri omenjeni nalogi bi bil neskončno hvaležen, ker sam je ne uspem razrešit...  Naj še enkrat povem, prejšnji teden mi je shm2a delal normalno, nisem popolnoma nič spreminjal v kodi, sedaj pa mi ne dela.."
    },
    {
        "role": "assistant_0",
        "message": "Nisem nikoli programiral semaforjev, samo iz firbca me je zanimalo kako delujejo. Imam shranjena dva zaznamka s primeri kode, če ti kaj pomaga pri iskanju napake.  http://beej.us/guide/bgipc/output/html/... http://snap.nlc.dcccd.edu/learn/fuller3..."
    },
    {
        "role": "user",
        "message": "@assistant_0 hvala, imamo tudi na strani za vaje literaturo, ampak i fail to see where the problem is.."
    },
    {
        "role": "user",
        "message": "OK ker ne morem editirat več svojega prejšnjega posta...uspelo mi je sestavit tak daleč, da dela shm2a, ne dela pa shm2b (nek problem je s semaforjem - izpiše mi \"napaka sem_id\")  evo kodi še enkrat:    shm2a   #include<stdio.h>\n#include<stdlib.h>\n#include<sys/shm.h>\n#include<sys/sem.h>\n#include<sys/types.h>\n#include<sys/ipc.h>\n#include<string.h>\n\nint main() {\n\tint shmid, sem_id;\n\tchar* k;\n\tstruct sembuf sem;\n\n\tshmid=shmget(1005, sizeof(20), IPC_CREAT|IPC_EXCL|0600);\n\n\tif(shmid<0) {\n\t\tprintf(\"Napaka shmid!\\n\");\n\t}\n\telse {\n\t\tprintf(\"OK\\n\");\t\n\t}\n\n\tk=(char*)shmat(shmid,(void*)0,0);\n\tif(k==(char*)-1) {\n\t\tprintf(\"Napaka k!\\n\");\n\t}\n\telse {\n\t\tprintf(\"OK\\n\");\n\t}\n\n\tstrcpy(k,\"\");\n\tsem_id=semget(1006,1,IPC_EXCL|IPC_CREAT|0600);\n\n\tif(sem_id<0) {\n\t\tprintf(\"Napaka sem_id!\\n\");\n\t}\n\telse {\n\t\tprintf(\"OK\\n\");\n\t}\n\n\tsemctl(sem_id,0,SETVAL,1);\n\n\tsem.sem_flg=0;\n\tsem.sem_num=0;\n\tsem.sem_op=0;\n\tsemop(sem_id,&sem,1);\n\tsem.sem_op=-1;\n\tsemop(sem_id,&sem,1);\n\tprintf(\"V pomnilniku: %s\\n \",k);\n\tsem.sem_op=1;\n\tsemop(sem_id,&sem,1);\n\n\tshmdt(k);\n\t\n\tshmctl(shmid,IPC_RMID,0);\n\tsemctl(sem_id,0,IPC_RMID);\n\n\treturn 0;\t\n}\n   Shm2b    #include<stdio.h>\n#include<stdlib.h>\n#include<sys/shm.h>\n#include<sys/sem.h>\n#include<sys/types.h>\n#include<sys/ipc.h>\n#include<string.h>\n\nint main() {\n\tint shmid, sem_id;\n\tchar* k;\n\tstruct sembuf sem;\n\n\tshmid=shmget(1005,0,0);\n\n\tif(shmid<0) {\n\t\tprintf(\"Napaka shmid!\\n\");\n\t}\n\telse {\n\t\tprintf(\"OK\\n\");\n\t}\n\n\tk=(char*)shmat(shmid,(void*)0,0);\n\n\tif(k==(char*)-1) {\n\t\tprintf(\"Napaka k!\\n\");\n\t}\n\telse {\n\t\tprintf(\"OK\\n\");\n\t}\n\n\tsem_id=semget(1005,1,0600);\n\tif(sem_id<0) {\n\t\tprintf(\"Napaka sem_id\\n\");\n\t}\n\telse {\n\t\tprintf(\"OK\\n\");\n\t}\n\n\tsemctl(sem_id,0,SETVAL,1);\n\n\tsem.sem_op=-1;\n\tsem.sem_flg=0;\n\tsem.sem_num=0;\n\tsemop(sem_id,&sem,1);\n\tstrcpy(k,\"niz dolg 20 znakov..\");\n\tsem.sem_op=1;\n\tsemop(sem_id,&sem,1);\n\n\tshmdt(k);\n\n\treturn 0;\n}"
    },
    {
        "role": "assistant_1",
        "message": "shm2a: shmid=shmget(1005, sizeof(20), IPC_CREAT|IPC_EXCL|0600); -> shmid=shmget(1005, 21, IPC_CREAT|IPC_EXCL|0600);  shm2b: sem_id=semget(1005,1,0600); -> sem_id=semget(1006,1,0600);"
    }
]