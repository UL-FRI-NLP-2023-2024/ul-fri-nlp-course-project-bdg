[
  {
    "message": "Na OrangePi Zero postavljam wifi access point. Gor teče Armbian Bionic.  wlan0 vmesnik ima fiksni IP: 172.16.0.1.  Postavil sem hostap, dela super, se povežem na omrežje, dobim IP naslov in lahko pingam 172.16.0.1.  Ne dela pa DNS resolving. Lahko pa recimo pingam 8.8.8.8. Za DNS uporabljam dnsmasq.  Tole je konfiguracija:  cat /etc/dnsmasq.conf  port=53\ndomain-needed\nbogus-priv\n\nresolv-file=/etc/dnsmasq/resolv.conf\ninterface=wlan0\nlisten-address=172.16.0.1\nbind-interfaces\naddn-hosts=/etc/dnsmasq/hosts.conf\ndhcp-range=172.16.0.50,172.16.0.150,12h\ndhcp-leasefile=/var/lib/misc/dnsmasq.leases  Tole je vsebina v configu omenjenih datotek:  cat /etc/dnsmasq/resolv.conf  nameserver 127.0.0.1\nnameserver 8.8.8.8\nnameserver 8.8.4.4  cat /etc/dnsmasq/hosts.conf  172.16.0.1 orangepi.wifi\n172.16.0.1 www.orangepi.wifi  Kakšna ideja kje je težava? Iz same OrangePi Zero naprave lahko normalno pingam katerikoli FQDN... Dnsmasq pa sicer čisto lepo teče:  sudo service dnsmasq status  &#9679; dnsmasq.service - dnsmasq - A lightweight DHCP and caching DNS server\n   Loaded: loaded (/lib/systemd/system/dnsmasq.service; enabled; vendor preset: enabled)\n   Active: active (running) since Wed 2019-03-06 20:44:16 UTC; 6min ago\n  Process: 1775 ExecStop=/etc/init.d/dnsmasq systemd-stop-resolvconf (code=exited, status=0/SUCCESS)\n  Process: 1809 ExecStartPost=/etc/init.d/dnsmasq systemd-start-resolvconf (code=exited, status=0/SUCCESS)\n  Process: 1804 ExecStart=/etc/init.d/dnsmasq systemd-exec (code=exited, status=0/SUCCESS)\n  Process: 1803 ExecStartPre=/usr/sbin/dnsmasq --test (code=exited, status=0/SUCCESS)\n Main PID: 1808 (dnsmasq)\n    Tasks: 14 (limit: 855)\n   CGroup: /system.slice/dnsmasq.service\n           &#9500;&#9472;1808 /usr/sbin/dnsmasq -x /run/dnsmasq/dnsmasq.pid -u dnsmasq -r /run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service\n           &#9500;&#9472;1902 /usr/sbin/dnsmasq -x /run/dnsmasq/dnsmasq.pid -u dnsmasq -r /run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service\n           &#9500;&#9472;1903 /usr/sbin/dnsmasq -x /run/dnsmasq/dnsmasq.pid -u dnsmasq -r /run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service\n           &#9500;&#9472;1904 /usr/sbin/dnsmasq -x /run/dnsmasq/dnsmasq.pid -u dnsmasq -r /run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service\n           &#9500;&#9472;1905 /usr/sbin/dnsmasq -x /run/dnsmasq/dnsmasq.pid -u dnsmasq -r /run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service\n           &#9500;&#9472;1906 /usr/sbin/dnsmasq -x /run/dnsmasq/dnsmasq.pid -u dnsmasq -r /run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service\n           &#9500;&#9472;1907 /usr/sbin/dnsmasq -x /run/dnsmasq/dnsmasq.pid -u dnsmasq -r /run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service\n           &#9500;&#9472;1908 /usr/sbin/dnsmasq -x /run/dnsmasq/dnsmasq.pid -u dnsmasq -r /run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service\n           &#9500;&#9472;1909 /usr/sbin/dnsmasq -x /run/dnsmasq/dnsmasq.pid -u dnsmasq -r /run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service\n           &#9500;&#9472;1910 /usr/sbin/dnsmasq -x /run/dnsmasq/dnsmasq.pid -u dnsmasq -r /run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service\n           &#9500;&#9472;1911 /usr/sbin/dnsmasq -x /run/dnsmasq/dnsmasq.pid -u dnsmasq -r /run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service\n           &#9500;&#9472;1912 /usr/sbin/dnsmasq -x /run/dnsmasq/dnsmasq.pid -u dnsmasq -r /run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service\n           &#9500;&#9472;1913 /usr/sbin/dnsmasq -x /run/dnsmasq/dnsmasq.pid -u dnsmasq -r /run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service\n           &#9492;&#9472;1914 /usr/sbin/dnsmasq -x /run/dnsmasq/dnsmasq.pid -u dnsmasq -r /run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service\n\nMar 06 20:44:14 orangepizero dnsmasq[1808]: read /etc/dnsmasq/hosts.conf - 2 addresses\nMar 06 20:44:15 orangepizero dnsmasq[1808]: reading /run/dnsmasq/resolv.conf\nMar 06 20:44:15 orangepizero dnsmasq[1808]: using nameserver 8.8.8.8#53\nMar 06 20:44:15 orangepizero dnsmasq[1808]: using nameserver 127.0.0.53#53\nMar 06 20:44:15 orangepizero dnsmasq[1809]: /etc/resolvconf/update.d/libc: Warning: /etc/resolv.conf is not a symbolic link to /run/resolvconf/resolv.conf\nMar 06 20:44:16 orangepizero systemd[1]: Started dnsmasq - A lightweight DHCP and caching DNS server.\nMar 06 20:44:44 orangepizero dnsmasq-dhcp[1808]: DHCPREQUEST(wlan0) 172.16.0.110 XXXXXXxxxxx\nMar 06 20:44:44 orangepizero dnsmasq-dhcp[1808]: DHCPACK(wlan0) 172.16.0.110 XXXXXXxxxxx XxXx\nMar 06 20:48:24 orangepizero dnsmasq-dhcp[1808]: DHCPREQUEST(wlan0) 172.16.0.74 XXXXXXxxxxx\nMar 06 20:48:24 orangepizero dnsmasq-dhcp[1808]: DHCPACK(wlan0) 172.16.0.74 XXXXXXxxxxx XxXx\n ",
    "user": "poweroff"
  },
  {
    "message": "Še tole, ko se povežem gor, ping orangepi.wifi ne vrne rezultatov... Oz., ping: orangepi.wifi: Ime ali storitev ni poznana  nmap 172.16.0.1  pa pravi takole:   Starting Nmap 7.60 ( https://nmap.org ) at 2019-03-06 22:01 CET\nNmap scan report for <strong>orangepi.wifi</strong> (172.16.0.1)\nHost is up (0.015s latency).\nNot shown: 998 closed ports\nPORT   STATE SERVICE\n22/tcp open  ssh\n53/tcp open  domain\n\nNmap done: 1 IP address (1 host up) scanned in 5.16 seconds ",
    "user": "poweroff"
  },
  {
    "message": "V /etc/dnsmasq.conf daš:   domain=orangepi.wifi\nno-resolve\nserver 8.8.8.8\nserver 8.8.4.4\nlocal=/orangepi.wifi/  ...v /etc/dnsmasq/resolv.conf pa samo:   nameserver 127.0.0.1  ...in si zmagal. ",
    "user": "BlaY0"
  },
  {
    "message": "Niti ne...  Če ne dam:   interface=wlan0\nlisten-address=172.16.0.1\nbind-interfaces  Se Dnsmasq ne zažene:  sudo service dnsmasq status   ? dnsmasq.service - dnsmasq - A lightweight DHCP and caching DNS server\n   Loaded: loaded (/lib/systemd/system/dnsmasq.service; enabled; vendor preset: enabled)\n   Active: failed (Result: exit-code) since Wed 2019-03-06 22:37:30 UTC; 2s ago\n  Process: 1695 ExecStop=/etc/init.d/dnsmasq systemd-stop-resolvconf (code=exited, status=0/SUCCESS)\n  Process: 1622 ExecStartPost=/etc/init.d/dnsmasq systemd-start-resolvconf (code=exited, status=0/SUCCESS)\n  Process: 1776 ExecStart=/etc/init.d/dnsmasq systemd-exec (code=exited, status=2)\n  Process: 1775 ExecStartPre=/usr/sbin/dnsmasq --test (code=exited, status=0/SUCCESS)\n Main PID: 1621 (code=exited, status=0/SUCCESS)\n\nMar 06 22:37:30 orangepizero systemd[1]: Starting dnsmasq - A lightweight DHCP and caching DNS server...\nMar 06 22:37:30 orangepizero dnsmasq[1775]: dnsmasq: syntax check OK.\nMar 06 22:37:30 orangepizero dnsmasq[1776]: dnsmasq: failed to create listening socket for port 53: Address already in use\nMar 06 22:37:30 orangepizero dnsmasq[1776]: failed to create listening socket for port 53: Address already in use\nMar 06 22:37:30 orangepizero dnsmasq[1776]: FAILED to start up\nMar 06 22:37:30 orangepizero systemd[1]: dnsmasq.service: Control process exited, code=exited status=2\nMar 06 22:37:30 orangepizero systemd[1]: dnsmasq.service: Failed with result 'exit-code'.\nMar 06 22:37:30 orangepizero systemd[1]: Failed to start dnsmasq - A lightweight DHCP and caching DNS server. ",
    "user": "poweroff"
  },
  {
    "message": "Pardon, dodaš, ne daš. Sem mislil da bo to samoumevno pa zgleda ni   Kje imaš pa bridge v katerem je wlan in eth interface? AP brez bridgea bo bolj švoh uporaben... ",
    "user": "BlaY0"
  },
  {
    "message": "Ja, sem tudi dodal, pa sicer service dela, ne pushne pa DNS serverjev.  Drugace imam posredovanje prometa reseno z iptables... kot receno na klientu ping na 8.8.8.8 dela, ping na www.google.com pa ne. ",
    "user": "poweroff"
  },
  {
    "message": "Se pravi takole:   sudo sh -c \"echo 1 > /proc/sys/net/ipv4/ip_forward\"  in:   sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE\nsudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT ",
    "user": "poweroff"
  },
  {
    "message": "Torej, trenutni /etc/dnsmasq.conf:   # Configuration file for dnsmasq.\nport=53\ndomain-needed\nbogus-priv\n\nresolv-file=/etc/dnsmasq/resolv.conf\nno-resolv\n\nserver=8.8.8.8\nserver=8.8.4.4\n\ninterface=wlan0\nlisten-address=172.16.0.1\nbind-interfaces\n\naddn-hosts=/etc/dnsmasq/hosts.conf\n\ndhcp-range=172.16.0.50,172.16.0.150,12h\n\ndhcp-leasefile=/var/lib/misc/dnsmasq.leases\n\ndomain=orangepi.wifi\nlocal=/orangepi.wifi/  Vse skupaj sicer zaženem takole (kot root):  nmcli radio wifi off\nrfkill unblock wlan\nifconfig wlan0 172.16.0.1 netmask 255.255.255.0 broadcast 172.16.0.255\nservice dnsmasq restart\n/usr/sbin/hostapd /etc/hostapd/hostapd.conf ",
    "user": "poweroff"
  },
  {
    "message": "A:  dig @172.16.0.1 -x 8.8.8.8...vrne kaj? Kaj pa vrne:  nmap --script broadcast-dhcp-discover ",
    "user": "BlaY0"
  },
  {
    "message": "Oboje sem pognal pri sebi (ko sem bil povezan na Wifi), ter Na OrangePi. V obeh primerih je isto:   dig @172.16.0.1 -x 8.8.8.8   ; <<>> DiG 9.11.3-1ubuntu1.5-Ubuntu <<>> @172.16.0.1 -x 8.8.8.8\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 53355\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 512\n;; QUESTION SECTION:\n;8.8.8.8.in-addr.arpa.\t\tIN\tPTR\n\n;; ANSWER SECTION:\n8.8.8.8.in-addr.arpa.\t20689\tIN\tPTR\tgoogle-public-dns-a.google.com.\n\n;; Query time: 60 msec\n;; SERVER: 172.16.0.1#53(172.16.0.1)\n;; WHEN: Fri Mar 08 22:07:24 UTC 2019\n;; MSG SIZE  rcvd: 93  Enako v obeh primerih:   sudo nmap --script broadcast-dhcp-discover   Starting Nmap 7.60 ( https://nmap.org ) at 2019-03-08 22:09 UTC\nWARNING: No targets were specified, so 0 hosts scanned.\nNmap done: 0 IP addresses (0 hosts up) scanned in 12.31 seconds\n ",
    "user": "poweroff"
  },
  {
    "message": "Če kaj pomaga tole... ko na OPi zaženem OpenVPN (ki nastavi default route, itd.), mi le-ta javi tole:   /etc/resolvconf/update.d/libc: Warning: /etc/resolv.conf is not a symbolic link to /run/resolvconf/resolv.conf  Očitno je torej nekaj čudnega tudi z resolvconf... ",
    "user": "poweroff"
  },
  {
    "message": "Sej ti OK resolva.  OK, nmpa ti ne izpiše dhcpoferja... poglej v /etc/resolv.conf (na WiFi klientu) če ti kaj nastavi... če je notri samo 127.0.0.1 potem poglej kam ti dhclient zapiše lease file in vanj poglej kaj ti dnsmasq servira za domain-name-servers. Če ni 172.16.0.1, potem ga forcaj tako da v dnsmasq.conf dodaš: dhcp-option=6,172,16,0,1 ",
    "user": "BlaY0"
  },
  {
    "message": "Hmm, očitno mi nastavi (v Foobuntu ima sedaj kontrolo nad resolv.conf NetworkManager):   cat /run/systemd/resolve/resolv.conf   nameserver 172.16.0.1\nnameserver 8.8.8.8\nsearch orangepi.wifi  In v bistvu zdaj dela... mogoče tudi zato, ker sem še enkrat eksplicitno rekel:   nano /etc/NetworkManager/NetworkManager.conf   [main]\nplugins=ifupdown,keyfile\n\n[ifupdown]\nmanaged=false\n\n[keyfile]\nunmanaged-devices=mac:aa:aa:bb:bb:ab:ba  oz:   [keyfile]\nunmanaged-devices=interface-name:wlan0 ",
    "user": "poweroff"
  },
  {
    "message": "Kolikor vem, če je NetworkManager managed, potem ti za DNS resolving skrbi lokalni dnsmasq in imaš posledično v resolv.conf datoteki samo 127.0.0.1, zato sem ti pa napisal da poglej v DHCP lease file če hočeš videti kakšen dhcpoffer dobiš. ",
    "user": "BlaY0"
  }
]